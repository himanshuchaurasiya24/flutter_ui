<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flutter Tricky Layout Scenarios Cheatsheet</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f6f8;
        }
        h1 {
            color: #02569B;
            border-bottom: 2px solid #02569B;
            padding-bottom: 10px;
        }
        h2 {
            color: #0175C2;
            margin-top: 30px;
        }
        .scenario {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .error {
            color: #D32F2F;
            font-weight: bold;
        }
        .solution {
            color: #2E7D32;
            font-weight: bold;
        }
        code {
            background-color: #f0f0f0;
            padding: 2px 5px;
            border-radius: 4px;
            font-family: Consolas, monospace;
            color: #d63384;
        }
        pre {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
            margin-right: 5px;
        }
        .tag-error { background-color: #ffcdd2; color: #b71c1c; }
        .tag-fix { background-color: #c8e6c9; color: #1b5e20; }
    </style>
</head>
<body>

    <h1>Flutter Layout Pitfalls & Solutions</h1>
    <p>This document covers common "tricky" layout scenarios in Flutter where constraints conflict or behave unexpectedly.</p>

    <!-- Scenario 1 -->
    <div class="scenario">
        <h2>1. The "Vertical viewport was given unbounded height"</h2>
        <p>This is the classic error discussed previously. It happens when a scrollable widget is placed inside another scrollable widget in the same direction.</p>
        
        <p><span class="tag tag-error">The Problem</span><br>
        Placing a <code>ListView</code> directly inside a <code>Column</code> which is inside a <code>SingleChildScrollView</code>.</p>
        
        <pre><code>// ‚ùå ERROR
SingleChildScrollView(
  child: Column(
    children: [
      Text('Header'),
      ListView(children: [...]), // Explosion! üí•
    ],
  ),
)</code></pre>

        <p><span class="tag tag-fix">The Fix</span><br>
        Use <code>shrinkWrap: true</code> and disable scrolling on the inner list.</p>
        
        <pre><code>// ‚úÖ SOLUTION
SingleChildScrollView(
  child: Column(
    children: [
      Text('Header'),
      ListView(
        shrinkWrap: true, // Calculate size based on children
        physics: NeverScrollableScrollPhysics(), // Scroll with parent
        children: [...],
      ),
    ],
  ),
)</code></pre>
    </div>

    <!-- Scenario 2 -->
    <div class="scenario">
        <h2>2. Expanded/Flexible outside of Flex</h2>
        <p>Widgets like `Expanded` and `Flexible` <strong>must</strong> be direct descendants of a Flex widget (Row, Column, or Flex).</p>

        <p><span class="tag tag-error">The Problem</span><br>
        Using <code>Expanded</code> inside a <code>Stack</code>, `ListView`, or simply as a child of `Container`.</p>

        <pre><code>// ‚ùå ERROR
Stack(
  children: [
    Expanded(child: Container(color: Colors.red)), // Error! üí•
  ],
)</code></pre>

        <p><span class="tag tag-fix">The Fix</span><br>
        For Stack, use <code>Positioned.fill</code>. generally, remove Expanded or verify parent is Row/Column.</p>

        <pre><code>// ‚úÖ SOLUTION
Stack(
  children: [
    Positioned.fill(child: Container(color: Colors.red)),
  ],
)</code></pre>
    </div>

    <!-- Scenario 3 -->
    <div class="scenario">
        <h2>3. Row Overflowing Screen Width</h2>
        <p>A <code>Row</code> does not scroll by default. If its children are too wide, you get the yellow/black hazard tape.</p>

        <p><span class="tag tag-error">The Problem</span><br>
        A <code>Row</code> with text or fixed-width widgets that exceed the screen width.</p>

        <pre><code>// ‚ùå ERROR
Row(
  children: [
    Text('A very very very very long text that pushes content off screen...'),
    Icon(Icons.star),
  ],
)</code></pre>

        <p><span class="tag tag-fix">The Fix</span><br>
        Wrap the flexible child in <code>Expanded</code> or <code>Flexible</code>.</p>

        <pre><code>// ‚úÖ SOLUTION
Row(
  children: [
    Expanded( // Takes available space, then wraps text
      child: Text('A very very very very long text...'),
    ),
    Icon(Icons.star), // Keeps its intrinsic size
  ],
)</code></pre>
    </div>

    <!-- Scenario 4 -->
    <div class="scenario">
        <h2>4. The "Intrinsic Height" Problem</h2>
        <p>Sometimes you want two widgets in a Row to have the same height (the height of the tallest child).</p>

        <p><span class="tag tag-error">The Challenge</span><br>
        By default, Row children have independent heights (if not stretched). A VerticalDivider might disappear if it has no defined height.</p>

        <pre><code>// ‚ö†Ô∏è ISSUE: Divider might not show up or size correctly
Row(
  children: [
    Text('Short'),
    VerticalDivider(), // Has 0 effective height here potentially
    Text('Tall\nText\nHere'),
  ],
)</code></pre>

        <p><span class="tag tag-fix">The Fix</span><br>
        Wrap the Row in <code>IntrinsicHeight</code>. <em>Note: This is expensive layout-wise, use sparingly.</em></p>

        <pre><code>// ‚úÖ SOLUTION
IntrinsicHeight(
  child: Row(
    crossAxisAlignment: CrossAxisAlignment.stretch, // Stretch children to max height
    children: [
      Center(child: Text('Short')),
      VerticalDivider(), // Now draws full height of row
      Text('Tall\nText\nHere'),
    ],
  ),
)</code></pre>
    </div>

    <!-- Scenario 5 -->
    <div class="scenario">
        <h2>5. TextField inside a Row</h2>
        <p>A <code>TextField</code> tries to be as wide as possible. Inside a <code>Row</code>, this causes an unbounded width error.</p>

        <p><span class="tag tag-error">The Problem</span><br>
        Placing a <code>TextField</code> directly inside a <code>Row</code> without width constraints.</p>

        <pre><code>// ‚ùå ERROR
Row(
  children: [
    Icon(Icons.search),
    TextField(), // Explosion! üí• Unbounded width.
  ],
)</code></pre>

        <p><span class="tag tag-fix">The Fix</span><br>
        Wrap the <code>TextField</code> in <code>Expanded</code> or <code>Flexible</code>.</p>

        <pre><code>// ‚úÖ SOLUTION
Row(
  children: [
    Icon(Icons.search),
    Expanded(
      child: TextField(), // Now fills remaining space
    ),
  ],
)</code></pre>
    </div>

    <!-- Scenario 6 -->
    <div class="scenario">
        <h2>6. Nested Vertical ListViews</h2>
        <p>Similar to the Column issue, putting a vertical <code>ListView</code> inside another vertical <code>ListView</code> causes a conflict.</p>

        <p><span class="tag tag-error">The Problem</span><br>
        The inner list tries to scroll independently but has infinite height constraint from the outer list.</p>

        <pre><code>// ‚ùå ERROR
ListView(
  children: [
    Text('Header'),
    ListView(children: [...]), // Error! üí•
  ],
)</code></pre>

        <p><span class="tag tag-fix">The Fix</span><br>
        Use <code>shrinkWrap: true</code> + <code>NeverScrollableScrollPhysics</code> on the inner list OR use <span class="tag tag-fix">Slivers</span> (CustomScrollView).</p>

        <pre><code>// ‚úÖ BEST SOLUTION (Slivers)
CustomScrollView(
  slivers: [
    SliverToBoxAdapter(child: Text('Header')),
    SliverList(delegate: ...), // Inner list logic
  ],
)</code></pre>
    </div>

    <!-- Scenario 7 -->
    <div class="scenario">
        <h2>7. Keyboard Covering TextFields</h2>
        <p>When the keyboard opens, it might cover your input fields at the bottom of the screen.</p>

        <p><span class="tag tag-error">The Problem</span><br>
        Using a <code>Column</code> for a form without scrollability.</p>

        <pre><code>// ‚ö†Ô∏è ISSUE
Scaffold(
  body: Column(
    children: [
      Spacer(),
      TextField(), // Keyboard covers this!
    ],
  ),
)</code></pre>

        <p><span class="tag tag-fix">The Fix</span><br>
        Wrap the body in a <code>SingleChildScrollView</code> and ensure `resizeToAvoidBottomInset` is true (default). Ideally, also use padding.</p>

        <pre><code>// ‚úÖ SOLUTION
Scaffold(
  resizeToAvoidBottomInset: true, // Default
  body: SingleChildScrollView(
    child: Padding(
      padding: EdgeInsets.all(16),
      child: Column(
        children: [
          SizedBox(height: 300), // Filler
          TextField(), // Scrolls into view when focused
        ],
      ),
    ),
  ),
)</code></pre>
    </div>

    <!-- Scenario 8 -->
    <div class="scenario">
        <h2>8. The "Inner List Needs Height" Fix</h2>
        <p>If you *really* need a list inside a list (e.g., a horizontal list of hashtags inside a vertical feed), the simplest way to understand the fix is to give the inner list a height.</p>

        <p><span class="tag tag-error">The Problem</span><br>
        The outer vertical scroll view gives infinite vertical space. The inner horizontal list is fine, but if the inner list is ALSO vertical, it tries to be infinite too.</p>

        <pre><code>// ‚ùå ERROR (Vertical inside Vertical)
ListView(
  children: [
    Text('My Feed'),
    ListView(children: [...]), // Error: Unlimited height!
  ],
)</code></pre>

        <p><span class="tag tag-fix">The "Easy" Fix</span><br>
        Wrap the inner list in a <code>SizedBox</code> with a specific height. This tells the system: "Stop expanding! Be exactly 200 pixels tall."</p>

        <pre><code>// ‚úÖ SIMPLE FIXED HEIGHT
ListView(
  children: [
    Text('My Feed'),
    SizedBox(
      height: 200, // Explicit Constraint
      child: ListView(children: [...]), // Now it knows its limits!
    ),
  ],
)</code></pre>
    </div>

</body>
</html>
